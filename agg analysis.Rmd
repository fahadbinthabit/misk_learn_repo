---
title: "Aggregator analysis"
author: "Fahad BinThabit"
date: "17/10/2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, echo = FALSE)
options(digits = 7)
library(tinytex)
library(tidyverse)
library(rio)
library(DT)
library(data.table)

aggr_main <- read_csv("tameeni report/arranged data.csv")



```



**INDEX**



```datatable()
                                                                             
|-----------------|------------------------------------------------------------|
|insurer          |insurance company                                           |
|integration      |the integration between the insrurer and the aggregator     |
|portal           |Aggregator website                                          |
|-----------------|------------------------------------------------------------|

```


**The aggregator**

Motor insurance aggregators has been leading the market lately , they have 
became the main portal for retails customers.


Every day we measure the performance of the insurer response to integration 
requests made through aggregator portal.

we will measurement the following variables describing the total number of 
requests:

-success
-late but success
-error

**The Samples**

every week is a sample, and the figures showed that the late but success 
variable has relation with the number of requests and that error variable 
does not have relation with the number of requests.


this is kind of confusing, however will look into our data, but before will
we will calculate a three month average for all the requests using the 
variables 


|Average responses measured in 3 month period               |  count |Ratio    |
|-----------------------------------------------------------|--------|---------|
|number of requests                                         |27670   |100%     |
|avg number of success                                      |5651    |20%      |
|avg number of late but success                             |11545   |42%      |
|avg number of errors                                       |10473   |38%      | 
|-----------------------------------------------------------|--------|---------|

```{r  , echo = FALSE}
meanlateweek2 <- aggr_main %>%
  filter(date == "week 2") %>%
  mutate( meanlate =  mean(late_success) )

meanlateweek1 <- aggr_main %>%
  filter(date == "week 1") %>%
  mutate( meanlate =  mean(late_success) )

meanlateweek3 <- aggr_main %>%
  filter(date == "week 3") %>%
  mutate( meanlate =  mean(late_success) )


meanlateallweeks <- aggr_main %>%
    mutate( meanlate =  mean(late_success) ) %>%
  select(sample_count,meanlate)


meanerrorallweeks <- aggr_main %>%
    mutate( meanerr =  mean(Error_Response) ) %>%
  select(sample_count,meanerr)

meansuccessallweeks <- aggr_main %>%
    mutate( meansuccess =  mean(success) ) %>%
  select(sample_count,meansuccess)


meansamplecount <- aggr_main %>%
    mutate( meansample =  mean(sample_count) ) %>%
  select(sample_count, meansample)




propmeanlatesample <- merge(meanlateallweeks,meansamplecount,
                            by = "sample_count")

propmeanlatesampleall <- merge(propmeanlatesample, meansuccessallweeks,
                               by = "sample_count")

finalmeantable <- merge(propmeanlatesampleall, meanerrorallweeks,
                        by = "sample_count" )

finalmeantable <- as.data.table(finalmeantable)

finale <- finalmeantable %>%
  select( meansample, meanlate , meansuccess, meanerr   )


finaleratio <- finale %>%
    mutate(meanlateratio = meanlate/meansample,
           meanerroratio = meanerr/meansample,
           meansuccratio = meansuccess/meansample) 




```

**The first observation** 

We will  view the behavior of late but success and error reponses with 
the number of requests using the a linear model method 

```{r aggregator , echo = FALSE}


plotit <- ggplot(aggr_main , aes(x=late_success  , y= sample_count ,
                               col= Error_Response )) + geom_point() +
  geom_smooth(method = "lm") 

plotit

```

if you notice there is a relation in the model between variables , 
we will dive deeper and identify which variable is more likely to have relation with the total number of requests this to prove that the late responses are not related to connectivity but instead it is related to system processing 

**What about the late but success responses** 


```{r late_success}
aggr_main %>% 
  filter(date == "week 1") %>% 
  ggplot(aes(x = sample_count, y = late_success)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "how late_success behave with total requests")
  
  
```


```{r success}
aggr_main %>% 
  filter(date == "week 1") %>% 
  ggplot(aes(x = sample_count, y = success )) +
  geom_point() +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "how success behave with total requests")
```



##What does this tell me?

- There is an evidence that the number of requests increase when the number of 
late responses increase , which means that the late responses are not related 
to connectivity factor and that we have a problem in processing the 
information.
- There is an association between late but success and number of requests.
- We can use the number of requests to predict the 
late but success responses and vice versa. 



